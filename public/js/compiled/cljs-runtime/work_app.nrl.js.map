{"version":3,"sources":["work_app/nrl.cljs"],"mappings":"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","names":["p__32813","map__32814","cljs.core/--destructure-map","cljs.core.get","work-app.nrl/nrl-comp","url","name","id","js/module$node_modules$primereact$splitbutton$splitbutton_cjs.SplitButton","link","G__32816","work-app.events/>evt","G__32817","G__32824","fexpr__32823","G__32832","G__32825","js/module$node_modules$primereact$button$button_cjs.Button","fexpr__32840","G__32846","work-app.nrl/is-nrl?","file","ext","cljs.core._EQ_","work-app.nrl/file-conts->url","conts","map__32850","vec__32851","cljs.core.nth","lines","main-line","database","document","session","nrtdms","m","$","p1__32847#","cljs.core.filter","cljs.core/count","p1__32848#","cljs.core.map","l","p1__32849#","cljs.core.reduce","p__32854","vec__32855","acc","k","v","cljs.core.assoc","doc-no","doc-ver","dms-str","lib-str","num-str","ver-str","version-value","latest-str","work-app.nrl/consume-dropped-file","freader","js/FileReader","G__32862","cljs.core/random-uuid","work-app.nrl/drop-handler","e","files-obj","files","cljs.core.doall","p1__32865#","cljs.core.range","nrl-files","seq__32875","cljs.core/seq","chunk__32876","count__32877","i__32878","temp__5804__auto__","cljs.core/chunked-seq?","c__5568__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/first","cljs.core/next","work-app.nrl/nrl","p1__32888#","nrls","work-app.subs/<sub","work-app.shared/allow-drop","iter__5523__auto__","s__32890","cljs.core/LazySeq","c__5521__auto__","size__5522__auto__","b__32892","cljs.core/chunk-buffer","i__32891","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__32889","cljs.core/cons","cljs.core/rest","nrl","G__32893"],"sourcesContent":[";; (c) David F Stearns 2023\n(ns work-app.nrl\n  (:require [work-app.shared :as shared]\n            [reagent.core :as r]\n            [work-app.subs :as s :refer [<sub]]\n            [work-app.events :as e :refer [>evt]]\n            [\"primereact/splitbutton\" :refer [SplitButton]]\n            [\"primereact/button\" :refer [Button]]))\n\n(defn nrl-comp [{:keys [url name id]}]\n  [:div\n   [:> SplitButton {:label \"Copy Link\"\n                    :on-click #(let [link (str \"<a href=\" url \">\" name \"</a>\")]\n                                 (>evt [::e/toast {:summary link\n                                                   :detail \"copied to clipboard\"}])\n                                 (>evt [::e/copy-text link]))\n                    :model [{:label \"Copy URL\"\n                             :command #((>evt [::e/toast {:summary url\n                                                          :detail \"copied to clipboard\"}])\n                                        (>evt [::e/copy-text url]))}]\n                    :style {:margin-left \"4px\"\n                            :margin-top \"2px\"}}]\n   [:> Button {:label \"Remove\"\n               :style {:margin-left \"4px\"\n                       :margin-right \"4px\"\n                       :margin-top \"2px\"}\n               :on-click #((>evt [::e/nrl-remove id]))}]\n   [:a {:style {:margin-bottom \"3px\"}\n        :id (str id)\n        :href url} name]])\n\n(defn is-nrl? [file]\n  (let [name (.-name file)\n        ext (.slice name -3)]\n    (= ext \"nrl\")))\n\n(defn file-conts->url [conts]\n  (let [lines (.split conts \\newline)\n        main-line (get lines 1)\n        {:strs [database document session nrtdms] :as m}\n        (as-> main-line $\n          (.split $ \\!)\n          (filter #(< 0 (count %)) $)\n          (map #(.split % \\:) $)\n          (map (fn [l] (filter #(< 0 (count %)) l)) $)\n          (reduce (fn [acc [k v]] (assoc acc k v)) {} $))\n        [doc-no doc-ver] (.split document \\,)\n        dms-str \"dms=PDX-MIDDLE\"\n        lib-str (str \"lib=\" (.toLowerCase database))\n        num-str (str \"num=\" doc-no)\n        ver-str (str \"ver=\" doc-ver)\n        version-value (if (>= 4 (count lines))\n                        0\n                        (str (get lines 3)))\n        latest-str (str \"latest=\" version-value)]\n    (str \"iwl:\" (.join #js [dms-str lib-str num-str ver-str latest-str] \"&&\"))))\n\n(defn consume-dropped-file [file]\n  (let [freader (js/FileReader.)\n        name (.-name file)]\n    (set! (.-onload freader)\n          #(>evt [::e/nrl-add {:name name\n                               :id (str (random-uuid))\n                               :url (file-conts->url (.-result freader))}]))\n    (.readAsBinaryString freader file)))\n\n(defn drop-handler [e]\n  ;; (set! (.. e -dataTransfer -effectAllowed) \"copy\")\n  (.preventDefault e)\n  (let [files-obj (.. e -dataTransfer -files)\n        files (doall (map #(.item files-obj %) (range (.-length files-obj))))\n        nrl-files (filter is-nrl? files)]\n    (doseq [file files]\n      (consume-dropped-file file))))\n\n(defn nrl []\n  (let [nrls (<sub [::s/nrls])]\n    [:div {:id \"nrlDropZone\"\n           :on-drag-enter shared/allow-drop\n           :on-drag-over shared/allow-drop\n           :on-drag-start #(.setData (.-dataTransfer %) \"text/plain\" \"\")\n           :on-drop drop-handler\n           :style {:min-height \"300px\"}}\n     (when (< 0 (count nrls))\n       (doall\n        (for [nrl nrls]\n          ^{:key (str (:id nrl))} [nrl-comp nrl])))\n     (when (< 0 (count nrls))\n       [:> Button {:style {:margin \"5px\"}\n                   :label \"Clear All\"\n                   :on-click #(>evt [::e/nrl-remove-all])}])]))\n\n(comment\n  (let [ml \"!nrtdms:0:!session:PDX-DMS1:!database:PDX:!document:21534605,1:\"\n        {:strs [database document session nrtdms] :as m}\n        (as-> ml $\n          (.split $ \\!)\n          (filter #(< 0 (count %)) $)\n          (map #(.split % \\:) $)\n          (map (fn [l] (filter #(< 0 (count %)) l)) $)\n          (reduce (fn [acc [k v]] (assoc acc k v)) {} $))\n        [doc-no doc-ver] (.split document \\,)\n        dms-str \"dms=PDX-MIDDLE\"\n        lib-str (str \"lib=\" (.toLowerCase database))\n        num-str (str \"num=\" doc-no)\n        ver-str (str \"ver=\" doc-ver)\n        latest-str (str \"latest=\")]\n    [doc-no doc-ver database document session nrtdms m]))"]}